<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
</head>
<style>
    html,
    body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    .la {
        width: auto;
        height: auto;
        right: 0;
        margin-right: 15px;
        font-size: large;
        display: inline;
        float: right;
        background-color: #EA4C89;
        border-radius: 8px;
        border-style: none;
        box-sizing: border-box;
        color: #FFFFFF;
        cursor: pointer;
        font-family: "Haas Grot Text R Web", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
        font-weight: 500;
        line-height: 20px;
        list-style: none;
        margin: 0;
        outline: none;
        padding: 10px 16px;
        position: relative;
        text-align: center;
        text-decoration: none;
        transition: color 100ms;
        vertical-align: baseline;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
    }

    .la:hover {
        background-color: #F082AC;
        box-shadow: #f082acce 0 8px 15px;
        transform: translateY(-2px);
    }

    .la:active {
        box-shadow: none;
        transform: translateY(0);
    }

    .la:disabled {
        pointer-events: none;
        background-color: #f082ac48;
    }

    .row {
        margin-left: 10px;
        border: 1px solid;
        padding: 10px;
    }

    .dynamic-input {
        width: 600px;
        font-size: 14px;
    }
</style>

<body>
    <header>
        <div class="row" style="text-align: center;background-color: red;">
            !!! ‡∏°‡∏±‡∏ô‡∏¢‡∏±‡∏á‡∏Å‡∏≤‡∏Å‡πÜ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ Pull Request ‡∏°‡∏≤‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö !!!
        </div>
    </header>
    <div class="main"></div>
    <footer>

    </footer>
    <script>
        function resizeInput(input) {
            const textLength = input.value.length;
            if (textLength >= 720 && textLength <= 600) {
                input.style.width = textLength * 8 + 'px';
            }
        }
        /**@type {{name:string,defaultArgs:string}[]}*/


        window.onload = async function () {
            console.log('Welcome To GUI')

            var config
            var app
            var data_la

            async function fetch_data() {
                config = await (fetch('/get-config', {
                    method: 'GET',
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                }).then(res => res.json()))
                app = config.app

                data = await (fetch('/temp-data', {
                    method: 'GET',
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                }).then(res => res.json()))

                data_la = data.la

                for (let x in data_la) {
                    ad = data_la[x]
                    if (ad.lock === true) {
                        index = app.findIndex(v => v.name === x)
                        app.forEach((_, i) => {
                            app[i].lock = true
                            app[i].rename = (i === index) ? 'Launched' : 'Fully'
                        })
                        break
                    }
                }
            }

            await fetch_data()

            var main = document.querySelector('.main')

            async function create_ui(main) {
                app.forEach(a => {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á element div
                    let node = document.createElement('div');
                    node.className = 'row';

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° 'A1111' ‡πÄ‡∏õ‡πá‡∏ô text node ‡πÉ‡∏ô div
                    let title = document.createTextNode(a.name);
                    node.appendChild(title);

                    // // ‡πÄ‡∏û‡∏¥‡πà‡∏° input checkbox ‡πÅ‡∏•‡∏∞ label 'Installed'
                    // let installed = document.createElement('input');
                    // installed.type = 'checkbox';
                    // installed.id = 'readonly'
                    // let labelInstalled = document.createElement('label');
                    // labelInstalled.textContent = 'Installed';
                    // labelInstalled.id = a.name
                    // node.appendChild(installed);
                    // node.appendChild(labelInstalled);

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° input checkbox ‡πÅ‡∏•‡∏∞ label 'Use Google Drive'
                    let use_g_drive = document.createElement('input');
                    use_g_drive.type = 'checkbox';
                    let labelGoogleDrive = document.createElement('label');
                    labelGoogleDrive.textContent = 'Use Google Drive';
                    node.appendChild(use_g_drive);
                    node.appendChild(labelGoogleDrive);

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° button 'Launch'

                    let this_data = data_la?.[a.name]

                    let launchButton = document.createElement('button');
                    launchButton.className = 'la';
                    launchButton.textContent = a.rename ?? 'Launch'
                    launchButton.id = a.name
                    launchButton.disabled = a.lock ?? false
                    node.appendChild(launchButton);
                    main.appendChild(node)

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á div ‡πÉ‡∏ô div ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞ input text ‡πÉ‡∏ô div ‡πÉ‡∏´‡∏°‡πà
                    let commandLineDiv = document.createElement('div');
                    let commandLineText = document.createTextNode('CommandLineArgs:');
                    let inputCommandLine = document.createElement('input');
                    inputCommandLine.type = 'text';
                    inputCommandLine.className = 'dynamic-input';
                    inputCommandLine.id = a.name
                    inputCommandLine.value = a.defaultArgs
                    inputCommandLine.oninput = function () {
                        resizeInput(inputCommandLine);
                    };
                    commandLineDiv.appendChild(commandLineText);
                    commandLineDiv.appendChild(inputCommandLine);
                    node.appendChild(commandLineDiv);
                    let reset = document.createElement("button")
                    reset.style.display = 'inline'
                    reset.textContent = 'üîÉ'
                    commandLineDiv.append(reset)


                })
            }

            create_ui(main)

            document.body.addEventListener('click', async function (ev) {
                let target = ev.target
                if (target) {
                    if (target.id === 'readonly') {
                        ev.preventDefault()
                    } else if (target.className === 'la') {

                        document.querySelectorAll('.la').forEach(e => {
                            e.disabled = true
                        })

                        let elem = document.querySelectorAll(`#${target.id}`)

                        let args
                        elem.forEach(e => {
                            if (e.tagName === 'INPUT') args = e.value
                        })
                        fetch(`/la`, {
                            method: "POST",
                            body: JSON.stringify({
                                name: target.id,
                                args: args,
                                'lock': true,
                                'rename': 'Launched'
                            }),
                            headers: {
                                "Content-type": "application/json; charset=UTF-8"
                            }
                        })
                            .then(res => res.text())
                            .then(text => console.log(text))
                        await fetch_data()
                        let main = document.querySelector('.main')
                        let child = main.lastElementChild
                        while (child) {
                            main.removeChild(child);
                            child = main.lastElementChild;
                        }
                        create_ui(main)
                    }
                }
            })
        }
    </script>
</body>

</html>